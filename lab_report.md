# 0 复现目标
本次复现实验基于万琦玲前辈在毕设代码仓库中提及的，位于Notion上的[复现手册](https://little-grouse-686.notion.site/2aa24579f7ff426ba9aa0c64ecc5d390)进行。
撰写该文档，乃是记录复现过程中的操作和遇到的问题，方便复盘和排查异常情况。

# 1 环境配置
具体参考[环境配置](https://little-grouse-686.notion.site/df78ed3318664014941861e30679b4eb)。

在 *VMWare Workstation Player* 中安装 *Ubuntu 22.04 LTS* 。该过程步骤较为简单明晰，此处不予赘述。

进入系统后，在 *显示应用程序* 界面中，找到 *软件和更新* 选项，将其中的 *下载自* 更改为阿里云的镜像源。

使用如下命令，安装所需的依赖。
```bash
sudo apt-get install npm
npm install -g truffle
sudo apt install nodejs

sudo apt-get install software-properties-common
sudo add-apt-repository -y ppa:ethereum/ethereum
sudo apt-get update
sudo apt-get install ethereum

npm install web3
apt-get install solc
```

未遇到任何报错信息。使用`-v`或`--version`检查各依赖的版本号时，均未出现异常。

# 2 传统区块链的初始化和启动

具体参考[传统区块链初始化和启动](https://little-grouse-686.notion.site/f11a3c2549d34cd58225d6e71a2ad6ca)。

由于周畅学姐建议直接从树状区块链开始实验，笔者并未完成该复现实验。

# 3 树状区块链的初始化和启动

具体参考[树状区块链启动和创建节点](https://little-grouse-686.notion.site/a1ad745a7e0f4ce2840cd78dfff138b4)。

**！不明晰点！复现手册中，并未给出创世块`genesis.json`的配置信息。**
解决方法：使用传统区块链的初始化和启动中给出的创世块配置信息`genesis.json`替代。目前尚未发现副作用。

在系统的 *文档* 文件夹中，新建一个名为`TreeBlockchain`的文件夹，并在其中，放入上文所述的`genesis.json`。其内容如下：

```json
{
  "config": {
    "chainId": 666,
    "homesteadBlock": 0,
    "eip150Block": 0,
    "eip150Hash": "0x0000000000000000000000000000000000000000000000000000000000000000",
    "eip155Block": 0,
    "eip158Block": 0,
    "byzantiumBlock": 0,
    "constantinopleBlock": 0,
    "petersburgBlock": 0,
    "istanbulBlock": 0,
    "ethash": {}
  },
  "nonce": "0x0",
  "timestamp": "0x5ddf8f3e",
  "extraData": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "gasLimit": "0x47b760",
  "difficulty": "0x00002",
  "mixHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "coinbase": "0x0000000000000000000000000000000000000000",
  "alloc": { },
  "number": "0x0",
  "gasUsed": "0x0",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000"
}
```

同时，将周畅前辈提供的`geth`二进制文件重命名为`geth1`，放入系统的`/usr/bin/`目录下。

**！不明晰点！直接使用geth，得到了形如`...provided but not defined`的错误信息。**

解决方法：使用`sudo geth1`替代，错误信息消失。

以上准备工作完成后，初始化并启动区块链：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcaddr 127.0.0.1  --rpcport "8545" --rpccorsdomain "*" --datadir gethdata --port "30303" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 init genesis.json

sudo geth1 --identity "MyEth" --rpcaddr 127.0.0.1 --rpc --rpcport "8545" --rpccorsdomain "*" --datadir gethdata --port "30303" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --allow-insecure-unlock --dev.period 1 console
```

进入JavaScript控制台。在其中创建账户：

```bash
personal.newAccount("123456")
```

获得返回的账户名称，为`0x32d655db60309c87b95387e3b843253d43ba7731`。根据复现手册指示，将`genesis.json`修改为如下内容：

```json
{
  "config": {
    "chainId": 666,
    "homesteadBlock": 0,
    "eip150Block": 0,
    "eip150Hash": "0x0000000000000000000000000000000000000000000000000000000000000000",
    "eip155Block": 0,
    "eip158Block": 0,
    "byzantiumBlock": 0,
    "constantinopleBlock": 0,
    "petersburgBlock": 0,
    "istanbulBlock": 0,
    "ethash": {}
  },
  "alloc": {
    "0x32d655db60309c87b95387e3b843253d43ba7731": {
      "balance":"50000000000000000000000000000000000000000",
      "position":"test0123456789",
      "txtime":1
    }
  },
  "nonce": "0x0",
  "timestamp": "0x5ddf8f3e",
  "extraData": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "gasLimit": "0x47b760",
  "difficulty": "0x00002",
  "mixHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "coinbase": "0x0000000000000000000000000000000000000000",
  "number": "0x0",
  "gasUsed": "0x0",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000"
}
```

随后，在终端中输入`exit`退出JavaScript控制台，再将`TreeBlockchain/gethdata/geth`删除。

使用如下指令，重新初始化并启动区块链：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcaddr 127.0.0.1  --rpcport "8545" --rpccorsdomain "*" --datadir gethdata --port "30303" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 init genesis.json

sudo geth1 --identity "MyEth" --rpcaddr 127.0.0.1 --rpc --rpcport "8545" --rpccorsdomain "*" --datadir gethdata --port "30303" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --allow-insecure-unlock --dev.period 1 console
```

进入JavaScript控制台。进入后，输入如下指令查看余额：

```js
eth.getBalance(eth.accounts[0])
// 5e+40
```

输入以下指令解锁账户：

```js
personal.unlockAccount(eth.accounts[0],"123456",15000)
// true
```

再输入如下指令，连续按数次回车：

```js
//部署合约contract在移动区块链上,将下述代码直接粘贴到控制台
abi = JSON.parse('[{\"constant\":false,\"inputs\":[{\"internalType\":\"string\",\"name\":\"uuid\",\"type\":\"string\"}],\"name\":\"revalue\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"string\",\"name\":\"uuid\",\"type\":\"string\"}],\"name\":\"getQuality\",\"outputs\":[{\"internalType\":\"int256\",\"name\":\"\",\"type\":\"int256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"string\",\"name\":\"uuid\",\"type\":\"string\"}],\"name\":\"getSinglePos\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"string\",\"name\":\"uuid\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"time\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"_latOri\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"_lonOri\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"_latFix\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"_lonFix\",\"type\":\"uint256\"}],\"name\":\"setSinglePos\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]')
bytecode = "0x608060405234801561001057600080fd5b506118cb806100206000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c806332c267e2146100515780636e73a9b51461012057806376556a411461020d578063ce8f2494146102f8575b600080fd5b61010a6004803603602081101561006757600080fd5b810190808035906020019064010000000081111561008457600080fd5b82018360208201111561009657600080fd5b803590602001918460018302840111640100000000831117156100b857600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505091929192905050506103b3565b6040518082815260200191505060405180910390f35b61020b600480360360c081101561013657600080fd5b810190808035906020019064010000000081111561015357600080fd5b82018360208201111561016557600080fd5b8035906020019184600183028401116401000000008311171561018757600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050919291929080359060200190929190803590602001909291908035906020019092919080359060200190929190803590602001909291905050506104b1565b005b6102c66004803603602081101561022357600080fd5b810190808035906020019064010000000081111561024057600080fd5b82018360208201111561025257600080fd5b8035906020019184600183028401116401000000008311171561027457600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050610a8c565b604051808681526020018581526020018481526020018381526020018281526020019550505050505060405180910390f35b6103b16004803603602081101561030e57600080fd5b810190808035906020019064010000000081111561032b57600080fd5b82018360208201111561033d57600080fd5b8035906020019184600183028401116401000000008311171561035f57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050610d8e565b005b6000600a826040518082805190602001908083835b602083106103eb57805182526020820191506020810190506020830392506103c8565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060020160009054906101000a900460ff1661043c57600090506104ac565b600a826040518082805190602001908083835b60208310610472578051825260208201915060208101905060208303925061044f565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206009015490505b919050565b600a866040518082805190602001908083835b602083106104e757805182526020820191506020810190506020830392506104c4565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060020160009054906101000a900460ff1661070b576001600a876040518082805190602001908083835b602083106105675780518252602082019150602081019050602083039250610544565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060020160006101000a81548160ff0219169083151502179055506000600a876040518082805190602001908083835b602083106105ec57805182526020820191506020810190506020830392506105c9565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600101819055506001600a876040518082805190602001908083835b6020831061065e578051825260208201915060208101905060208303925061063b565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600301819055506000600a876040518082805190602001908083835b602083106106d057805182526020820191506020810190506020830392506106ad565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600901819055505b60006001600a886040518082805190602001908083835b602083106107455780518252602082019150602081019050602083039250610722565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206001015401905080600a886040518082805190602001908083835b602083106107b65780518252602082019150602081019050602083039250610793565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206001018190555085600a886040518082805190602001908083835b602083106108275780518252602082019150602081019050602083039250610804565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060080160008381526020019081526020016000208190555084600a886040518082805190602001908083835b602083106108a95780518252602082019150602081019050602083039250610886565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060040160008381526020019081526020016000208190555083600a886040518082805190602001908083835b6020831061092b5780518252602082019150602081019050602083039250610908565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060050160008381526020019081526020016000208190555082600a886040518082805190602001908083835b602083106109ad578051825260208201915060208101905060208303925061098a565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060060160008381526020019081526020016000208190555081600a886040518082805190602001908083835b60208310610a2f5780518252602082019150602081019050602083039250610a0c565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600701600083815260200190815260200160002081905550610a8387610d8e565b50505050505050565b600080600080600080600a876040518082805190602001908083835b60208310610acb5780518252602082019150602081019050602083039250610aa8565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600101549050600a876040518082805190602001908083835b60208310610b3a5780518252602082019150602081019050602083039250610b17565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600401600082815260200190815260200160002054600a886040518082805190602001908083835b60208310610bb85780518252602082019150602081019050602083039250610b95565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600501600083815260200190815260200160002054600a896040518082805190602001908083835b60208310610c365780518252602082019150602081019050602083039250610c13565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600601600084815260200190815260200160002054600a8a6040518082805190602001908083835b60208310610cb45780518252602082019150602081019050602083039250610c91565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600701600085815260200190815260200160002054600a8b6040518082805190602001908083835b60208310610d325780518252602082019150602081019050602083039250610d0f565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600801600086815260200190815260200160002054955095509550955095505091939590929450565b6000600a826040518082805190602001908083835b60208310610dc65780518252602082019150602081019050602083039250610da3565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206009015490506000600a836040518082805190602001908083835b60208310610e375780518252602082019150602081019050602083039250610e14565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600101549050600080600a856040518082805190602001908083835b60208310610ea95780518252602082019150602081019050602083039250610e86565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600601600084815260200190815260200160002054600a866040518082805190602001908083835b60208310610f275780518252602082019150602081019050602083039250610f04565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206004016000858152602001908152602001600020541061107857600a856040518082805190602001908083835b60208310610faa5780518252602082019150602081019050602083039250610f87565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600601600084815260200190815260200160002054600a866040518082805190602001908083835b602083106110285780518252602082019150602081019050602083039250611005565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600401600085815260200190815260200160002054039050611178565b600a856040518082805190602001908083835b602083106110ae578051825260208201915060208101905060208303925061108b565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600401600084815260200190815260200160002054600a866040518082805190602001908083835b6020831061112c5780518252602082019150602081019050602083039250611109565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206006016000858152602001908152602001600020540390505b600a856040518082805190602001908083835b602083106111ae578051825260208201915060208101905060208303925061118b565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600701600084815260200190815260200160002054600a866040518082805190602001908083835b6020831061122c5780518252602082019150602081019050602083039250611209565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206005016000858152602001908152602001600020541061137d57600a856040518082805190602001908083835b602083106112af578051825260208201915060208101905060208303925061128c565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600701600084815260200190815260200160002054600a866040518082805190602001908083835b6020831061132d578051825260208201915060208101905060208303925061130a565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060050160008581526020019081526020016000205403915061147d565b600a856040518082805190602001908083835b602083106113b35780518252602082019150602081019050602083039250611390565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600501600084815260200190815260200160002054600a866040518082805190602001908083835b60208310611431578051825260208201915060208101905060208303925061140e565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206007016000858152602001908152602001600020540391505b60088182028384600402020111611495576001840193505b6009600a84816114a157fe5b0614156114af576001840193505b6001831180156115be5750603c600a866040518082805190602001908083835b602083106114f257805182526020820191506020810190506020830392506114cf565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600801600060018603815260200190815260200160002054600a876040518082805190602001908083835b602083106115735780518252602082019150602081019050602083039250611550565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060080160008681526020019081526020016000205403115b156115ca576001840393505b6001831180156116da5750610258600a866040518082805190602001908083835b6020831061160e57805182526020820191506020810190506020830392506115eb565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600801600060018603815260200190815260200160002054600a876040518082805190602001908083835b6020831061168f578051825260208201915060208101905060208303925061166c565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060080160008681526020019081526020016000205403115b156116e6576014840393505b6001831180156117f657506104b0600a866040518082805190602001908083835b6020831061172a5780518252602082019150602081019050602083039250611707565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600801600060018603815260200190815260200160002054600a876040518082805190602001908083835b602083106117ab5780518252602082019150602081019050602083039250611788565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060080160008681526020019081526020016000205403115b15611802576064840393505b606484131561181057606493505b600084121561181e57600093505b83600a866040518082805190602001908083835b602083106118555780518252602082019150602081019050602083039250611832565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060090181905550505050505056fea265627a7a72315820a9684cf8e73cc78c8940e6f596597cd545ad180d58da47d3890d11dfabcfe09d64736f6c63430005100032"
QualContract = web3.eth.contract(abi);
web3.eth.estimateGas({data: bytecode})
Qual = QualContract.new({
    from: web3.eth.accounts[0], 
    data: bytecode, 
    gas: '1400000',
    position:"w2511111111111",
    txtime:277001
  },function (e, contract){
    console.log(e, contract);
    if(!e){
        if(!contract.address) {
            console.log("Contract transaction send: TransactionHash: " + contract.transactionHash + " waiting to be mined...");
        } else {
            console.log("Contract mined! Address: " + contract.address);
            console.log(contract);
        }
    }
});
```

再输入如下指令，连续按压数次回车：

```js
abi = JSON.parse('[{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"name\":\"geo_maps\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"num\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"gid\",\"type\":\"uint256\"}],\"name\":\"get_onetype\",\"outputs\":[{\"internalType\":\"int32[]\",\"name\":\"feature\",\"type\":\"int32[]\"},{\"internalType\":\"bytes32\",\"name\":\"names\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32\",\"name\":\"highway\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32\",\"name\":\"gtype\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32[]\",\"name\":\"path\",\"type\":\"bytes32[]\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"bytes32\",\"name\":\"hash\",\"type\":\"bytes32\"}],\"name\":\"get_types\",\"outputs\":[{\"internalType\":\"int32[]\",\"name\":\"feature\",\"type\":\"int32[]\"},{\"internalType\":\"bytes32[]\",\"name\":\"names\",\"type\":\"bytes32[]\"},{\"internalType\":\"bytes32[]\",\"name\":\"highways\",\"type\":\"bytes32[]\"},{\"internalType\":\"bytes32[]\",\"name\":\"gtypes\",\"type\":\"bytes32[]\"},{\"internalType\":\"bytes32[]\",\"name\":\"path\",\"type\":\"bytes32[]\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"gid\",\"type\":\"uint256\"},{\"internalType\":\"int32\",\"name\":\"minzoom\",\"type\":\"int32\"},{\"internalType\":\"int32\",\"name\":\"cost\",\"type\":\"int32\"},{\"internalType\":\"bool\",\"name\":\"oneway\",\"type\":\"bool\"},{\"internalType\":\"bool\",\"name\":\"building\",\"type\":\"bool\"},{\"internalType\":\"bytes32\",\"name\":\"highway\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32\",\"name\":\"name\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32\",\"name\":\"gtype\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32[]\",\"name\":\"path\",\"type\":\"bytes32[]\"}],\"name\":\"add_onetype\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"bytes32\",\"name\":\"hash\",\"type\":\"bytes32\"},{\"internalType\":\"uint256\",\"name\":\"gid\",\"type\":\"uint256\"}],\"name\":\"add_area_line\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]')
bytecode = "0x608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610e2a806100606000396000f3fe608060405234801561001057600080fd5b50600436106100625760003560e01c8063113620ec146100675780633fb80582146101475780638da5cb5b146102ea57806397673b7f14610334578063cbf3b01e14610447578063f90e5ca914610489575b600080fd5b6100936004803603602081101561007d57600080fd5b81019080803590602001909291905050506104c1565b604051808060200186815260200185815260200184815260200180602001838103835288818151815260200191508051906020019060200280838360005b838110156100ec5780820151818401526020810190506100d1565b50505050905001838103825284818151815260200191508051906020019060200280838360005b8381101561012e578082015181840152602081019050610113565b5050505090500197505050505050505060405180910390f35b6101736004803603602081101561015d57600080fd5b81019080803590602001909291905050506106b0565b60405180806020018060200180602001806020018060200186810386528b818151815260200191508051906020019060200280838360005b838110156101c65780820151818401526020810190506101ab565b5050505090500186810385528a818151815260200191508051906020019060200280838360005b838110156102085780820151818401526020810190506101ed565b50505050905001868103845289818151815260200191508051906020019060200280838360005b8381101561024a57808201518184015260208101905061022f565b50505050905001868103835288818151815260200191508051906020019060200280838360005b8381101561028c578082015181840152602081019050610271565b50505050905001868103825287818151815260200191508051906020019060200280838360005b838110156102ce5780820151818401526020810190506102b3565b505050509050019a505050505050505050505060405180910390f35b6102f2610aeb565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b610445600480360361012081101561034b57600080fd5b8101908080359060200190929190803560030b9060200190929190803560030b9060200190929190803515159060200190929190803515159060200190929190803590602001909291908035906020019092919080359060200190929190803590602001906401000000008111156103c257600080fd5b8201836020820111156103d457600080fd5b803590602001918460208302840111640100000000831117156103f657600080fd5b919080806020026020016040519081016040528093929190818152602001838360200280828437600081840152601f19601f820116905080830192505050505050509192919290505050610b10565b005b6104736004803603602081101561045d57600080fd5b8101908080359060200190929190505050610d27565b6040518082815260200191505060405180910390f35b6104bf6004803603604081101561049f57600080fd5b810190808035906020019092919080359060200190929190505050610d45565b005b60606000806000606060036040519080825280602002602001820160405280156104fa5781602001602082028038833980820191505090505b509450600060016000888152602001908152602001600020905080600401546040519080825280602002602001820160405280156105475781602001602082028038833980820191505090505b5091508060000160009054906101000a900460030b8660008151811061056957fe5b602002602001019060030b908160030b815250508060000160089054906101000a900460ff16156105bc576001866001815181106105a357fe5b602002602001019060030b908160030b815250506105e0565b6000866001815181106105cb57fe5b602002602001019060030b908160030b815250505b8060000160099054906101000a900460ff161561061f5760018660028151811061060657fe5b602002602001019060030b908160030b81525050610643565b60008660028151811061062e57fe5b602002602001019060030b908160030b815250505b80600201549450806001015493508060030154925060008090505b81600401548110156106a5578160050160008281526020019081526020016000205483828151811061068c57fe5b602002602001018181525050808060010191505061065e565b505091939590929450565b60608060608060606000600260008881526020019081526020016000206000015490506000809050600080831115610adf57826005026040519080825280602002602001820160405280156107145781602001602082028038833980820191505090505b509750826040519080825280602002602001820160405280156107465781602001602082028038833980820191505090505b509650826040519080825280602002602001820160405280156107785781602001602082028038833980820191505090505b509550826040519080825280602002602001820160405280156107aa5781602001602082028038833980820191505090505b50945060008091505b838210156109cf57600260008b8152602001908152602001600020600101600083815260200190815260200160002054905060006001600083815260200190815260200160002090506000600584029050828b828151811061081157fe5b602002602001019060030b908160030b815250508160000160009054906101000a900460030b8b600183018151811061084657fe5b602002602001019060030b908160030b815250508160000160049054906101000a900460030b8b600283018151811061087b57fe5b602002602001019060030b908160030b815250508160000160089054906101000a900460ff16156108d05760018b60038301815181106108b757fe5b602002602001019060030b908160030b815250506108f6565b60008b60038301815181106108e157fe5b602002602001019060030b908160030b815250505b8160000160099054906101000a900460ff16156109375760018b600483018151811061091e57fe5b602002602001019060030b908160030b8152505061095d565b60008b600483018151811061094857fe5b602002602001019060030b908160030b815250505b81600401546001860101945081600201548a858151811061097a57fe5b602002602001018181525050816001015489858151811061099757fe5b60200260200101818152505081600301548885815181106109b457fe5b602002602001018181525050505081806001019250506107b3565b826040519080825280602002602001820160405280156109fe5781602001602082028038833980820191505090505b5094506000809050600092505b84831015610adc57600260008c815260200190815260200160002060010160008481526020019081526020016000205491506000600160008481526020019081526020016000209050806004015460001b878380600101945081518110610a6e57fe5b60200260200101818152505060008090505b8160040154811015610acd5781600501600082815260200190815260200160002054888480600101955081518110610ab457fe5b6020026020010181815250508080600101915050610a80565b50508280600101935050610a0b565b50505b50505091939590929450565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610d1c5787600160008b815260200190815260200160002060000160006101000a81548163ffffffff021916908360030b63ffffffff16021790555086600160008b815260200190815260200160002060000160046101000a81548163ffffffff021916908360030b63ffffffff16021790555085600160008b815260200190815260200160002060000160086101000a81548160ff02191690831515021790555084600160008b815260200190815260200160002060000160096101000a81548160ff02191690831515021790555083600160008b81526020019081526020016000206001018190555082600160008b81526020019081526020016000206002018190555081600160008b8152602001908152602001600020600301819055506000600160008b815260200190815260200160002060040154905060008090505b8251811015610cfe57828181518110610cb857fe5b6020026020010151600160008d81526020019081526020016000206005016000848060010195508152602001908152602001600020819055508080600101915050610ca3565b5080600160008c815260200190815260200160002060040181905550505b505050505050505050565b60026020528060005260406000206000915090508060000154905081565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610df15760006002600084815260200190815260200160002060000160008154809291906001019190505590508160026000858152602001908152602001600020600101600083815260200190815260200160002081905550505b505056fea265627a7a7231582092454f0a2189d48c9559559a50326b36c0d27cad3f0bcd72ad99a4150833625964736f6c63430005100032";
StoreMapContract = web3.eth.contract(abi);
web3.eth.estimateGas({data: bytecode})
StoreMap = StoreMapContract.new({
    from: web3.eth.accounts[0], 
    data: bytecode, 
    gas: '1400000',
    position:"w3511111111111",
    txtime:278000
  },function (e, contract){
    console.log(e, contract);
    if(!e){
        if(!contract.address) {
            console.log("Contract transaction send: TransactionHash: " + contract.transactionHash + " waiting to be mined...");
        } else {
            console.log("Contract mined! Address: " + contract.address);
            console.log(contract);
        }
    }
});
```

最后执行：

```js
miner.start()
```

控制台提示开始生成DAG。待percentage字段达到99（不知为何到不了100，到99似乎就已经完成了），注意到两个不同于其他的输出：

```
null [object Object]
Contract mined! Address: 0x43fce95e0b0f62b1910840cef9778dcc0b71c5d9
[object Object]
null [object Object]
Contract mined! Address: 0x33dd213f562aaff09c5272b76433febf79a1da58
[object Object]
```

这应该就是复现手册中所说的合约地址。笔者将其保存在本文档中，供日后使用。

# 4 区块链创建多个节点

具体参考[区块链创建多个节点](https://little-grouse-686.notion.site/2a98bba3d006448695f5de855a18cc81)。

新建文件夹，名为 `MultiNodes` 。在其中，根据复现手册提示，放入`genesis.json`，内容如下：

```json
{
  "config": {
    "chainId": 91036,
    "homesteadBlock": 0,
    "eip150Block": 0,
    "eip155Block": 0,
    "eip158Block": 0,
    "byzantiumBlock": 0,
    "constantinopleBlock": 0,
    "petersburgBlock": 0
  },
  "alloc": {
  },
  "coinbase": "0x0000000000000000000000000000000000000000",
  "difficulty": "0x20000",
  "extraData": "",
  "gasLimit": "0xffffffff",
  "nonce": "0x0000000000000042",
  "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "timestamp": "0x00"
}
```

**！不明晰点！为什么创建2个节点，却要(初始化、启动)一共4次？在此之后，在JavaScript控制台中输入指令的步骤，究竟是在这4个中的哪一个？？**

解决方案：计划留下四个终端，并在第一个终端执行后续操作。但引起了副作用，详见下一个**！不明晰点！**。

>  后续的“终端”全部指代Visual Studio Code中的终端。

在VSCode中打开四个终端，分别命名为n1-p45, n1-p41, n2-p46和n2-p42。

在n1-p45中执行如下命令：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcport "8545" --rpcapi "eth,net,personal,web3" --rpccorsdomain "*" --datadir gethdata --port "30303" --nodiscover --networkid 91036 --allow-insecure-unlock --dev.period 1 --syncmode "full" init genesis.json && sudo geth1 --identity "MyEth" --rpc --rpcport "8545" --rpcapi "eth,net,personal,web3" --rpccorsdomain "*" --datadir gethdata --port "30303" --nodiscover --networkid 91036 --allow-insecure-unlock --dev.period 1 --syncmode "full" console
```

在n1-p41中执行如下命令：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcport "8541" --rpccorsdomain "*" --datadir gethdata --port "30301" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 init genesis.json && sudo geth1 --identity "MyEth" --rpc --rpcport "8541" --rpccorsdomain "*" --datadir gethdata --port "30301" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --allow-insecure-unlock --dev.period 1 console
```

**！不明晰点！在n1-p41中执行的命令失败了，提示Fatal: Failed to open database: resource temporarily unavailable。**

解决方法：在终端n1-p45中输入`exit`退出JS控制台，。并且，在后续终端中执行命令时，仅执行初始化部分的代码，不执行启动代码。这一步实际上治标不治本，已经为后文笔者被迫重做实验埋下了伏笔。

具体来说，笔者在n1-p45中输入`exit`之后，在n1-p41中仅输入：

```json
sudo geth1 --identity "MyEth" --rpc --rpcport "8541" --rpccorsdomain "*" --datadir gethdata --port "30301" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 init genesis.json
```

在n2-p46中输入：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcport "8546" --rpcapi "eth,net,personal,web3" --rpccorsdomain "*" --datadir gethdata --port "30304" --nodiscover --networkid 91036 --allow-insecure-unlock --dev.period 1 --syncmode "full" init genesis.json
```

在n2-p42中输入：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcport "8542" --rpccorsdomain "*" --datadir gethdata --port "30302" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 init genesis.json
```

如上将四次初始化和启动全部完成之后，回到n1-p45终端，单独执行启动命令：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcport "8545" --rpcapi "eth,net,personal,web3" --rpccorsdomain "*" --datadir gethdata --port "30303" --nodiscover --networkid 91036 --allow-insecure-unlock --dev.period 1 --syncmode "full" console
```

然后，在其中输入：

```js
personal.newAccount("123456")
```

获得控制台的返回如下：

```
INFO [10-20|16:20:03.627] Your new key was generated               address=0x8DabB2031362EcEe8F7BFd7Cf4861F9B3D0A1f10
WARN [10-20|16:20:03.627] Please backup your key file!             path=/home/endericedragon/文档/WQL-Lab/MultiNodes/gethdata/keystore/UTC--2022-10-20T08-20-00.511249328Z--8dabb2031362ecee8f7bfd7cf4861f9b3d0a1f10
WARN [10-20|16:20:03.627] Please remember your password! 
"0x8dabb2031362ecee8f7bfd7cf4861f9b3d0a1f10"
```

在n1-p45中输入`exit`退出JS控制台之后，根据上述返回的password，将genesis.json改为如下内容：

```json
{
    "config": {
        "chainId": 91036,
        "homesteadBlock": 0,
        "eip150Block": 0,
        "eip155Block": 0,
        "eip158Block": 0,
        "byzantiumBlock": 0,
        "constantinopleBlock": 0,
        "petersburgBlock": 0
    },
    "alloc": {
        "0x8dabb2031362ecee8f7bfd7cf4861f9b3d0a1f10": {
            "balance": "50000000000000000000000000000000000000000"
        }
    },
    "coinbase": "0x0000000000000000000000000000000000000000",
    "difficulty": "0x20000",
    "extraData": "",
    "gasLimit": "0xffffffff",
    "nonce": "0x0000000000000042",
    "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
    "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
    "timestamp": "0x00"
}
```

此后，删除`MultiNodes/gethdata/geth`目录，并在n1-p45中执行以下命令：

```bash
sudo geth1 init ./genesis.json --datadir "./gethdata"
```

未见错误提示，再键入如下命令：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcaddr 127.0.0.1 --rpccorsdomain "*" --datadir "./gethdata" --port 30303 --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --rpcport 8545 --allow-insecure-unlock --dev.period 1 console
```

键入如下JS代码：

```js
personal.unlockAccount(eth.accounts[0],"123456",15000)
// true
eth.getBalance(eth.accounts[0])
// 5e+40
```

接下来对第二个节点进行操作。

在n2-p46中，输入以下代码进行初始化：

```bash
sudo geth1 init ./genesis.json --datadir "./gethdata"
```

**！不明晰点！按照复现手册中的步骤执行，会收到错误，大意是geth接收到的参数太多了，它只要一个genesis.json参数。**

解决方法：使用geth1替代geth即可。

**！不明晰点！终端再次提示Temporarily Unavailable。**

解决方法：在n1-p45中输入`exit`退出JS控制台即可。

进行上述解决之后，在n2-p46中运行与出错前同样的命令，未见报错，于是继续运行下一条指令：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcaddr 127.0.0.1 --rpccorsdomain "*" --datadir "./gethdata" --port 30304 --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --rpcport 8546 --allow-insecure-unlock --dev.period 1 console
```

成功进入节点2的控制台。

为了获得节点1的信息，我们需要重新进入节点1的控制台。在n1-p45中输入如下指令进入控制台：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcaddr 127.0.0.1 --rpccorsdomain "*" --datadir "./gethdata" --port 30303 --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --rpcport 8545 --allow-insecure-unlock --dev.period 1 console
```

**！不明晰点！终端报错，声称Fatal: Error starting protocol stack: datadir already used by another process。**

解决方法：暂时退出节点2的控制台即可。在下文中，如无特殊指代，退出控制台一律意为在相应的终端中执行`exit`命令。

具体来说，在n2-p46中退出控制台之后，再回到n1-p45中执行与出错前一样的指令，成功进入节点1的控制台。输入：

```js
admin.nodeInfo.enode
// "enode://e675be1d3cf4f5ce4962c43c22f79e33353828255adb6cf9ff85cf4d0469631f35f09ecef2de86f2714c6b22149fa539428e909ca7f1c11cb0cdec72fb4b7245@127.0.0.1:30303?discport=0"
```

获得注释中的输出。退出n1-p45控制台，在n2-p46中输入：

```bash
sudo geth1 --identity "MyEth" --rpc --rpcaddr 127.0.0.1 --rpccorsdomain "*" --datadir "./gethdata" --port 30304 --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --rpcport 8546 --allow-insecure-unlock --dev.period 1 console
```

进入节点2的控制台。在其中输入：

```js
admin.addPeer("enode://e675be1d3cf4f5ce4962c43c22f79e33353828255adb6cf9ff85cf4d0469631f35f09ecef2de86f2714c6b22149fa539428e909ca7f1c11cb0cdec72fb4b7245@127.0.0.1:30303?discport=0")
// true
```

输入以下指令，查看是否互相链接成功：

```js
admin.peers
// []
```

**！不明晰点！这个和复现手册上应该看到的不一样欸？**

解决方法：两个节点不应该互相干扰。在实验最开始的初始化步骤，应该将两个节点的datadir设置成不一样的。必须重做整个实验，并为两个节点设置隔离的目录。

>  怀着悲痛的心情，笔者尝试重做这个实验。

清空目录`MultiNodes`，并建立文件夹Node1和Node2。为了避免使用过多的sudo，分别右键这两个文件夹选择属性，在权限选项卡中，将所有角色的权限统统改为“新建和删除文件“。

将VS Code中的终端的工作目录分别切换为：

| 终端名字 | 对应目录 |
| -------- | -------- |
| n1-p45   | Node1    |
| n1-p41   | Node1    |
| n2-p46   | Node2    |
| n2-p42   | Node2    |

在Node1,Node2文件夹中放入内容相同的genesis.json，内容和实验开头的相同，如下：

```json
{
  "config": {
    "chainId": 91036,
    "homesteadBlock": 0,
    "eip150Block": 0,
    "eip155Block": 0,
    "eip158Block": 0,
    "byzantiumBlock": 0,
    "constantinopleBlock": 0,
    "petersburgBlock": 0
  },
  "alloc": {
  },
  "coinbase": "0x0000000000000000000000000000000000000000",
  "difficulty": "0x20000",
  "extraData": "",
  "gasLimit": "0xffffffff",
  "nonce": "0x0000000000000042",
  "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "timestamp": "0x00"
}
```

在n1-p45中执行如下指令：

```bash
geth1 --identity "MyEth" --rpc --rpcport "8545" --rpcapi "eth,net,personal,web3" --rpccorsdomain "*" --datadir gethdata --port "30303" --nodiscover --networkid 91036 --allow-insecure-unlock --dev.period 1 --syncmode "full" init genesis.json && geth1 --identity "MyEth" --rpc --rpcport "8545" --rpcapi "eth,net,personal,web3" --rpccorsdomain "*" --datadir gethdata --port "30303" --nodiscover --networkid 91036 --allow-insecure-unlock --dev.period 1 --syncmode "full" console
```

成功进入控制台后，输入`exit`退出。

在n1-p41中执行如下指令：

```bash
geth1 --identity "MyEth" --rpc --rpcport "8541" --rpccorsdomain "*" --datadir gethdata --port "30301" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 init genesis.json && geth1 --identity "MyEth" --rpc --rpcport "8541" --rpccorsdomain "*" --datadir gethdata --port "30301" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --allow-insecure-unlock --dev.period 1 console
```

成功进入控制台后，输入`exit`退出。

在n2-p46中执行如下指令：

```bash
geth1 --identity "MyEth" --rpc --rpcport "8546" --rpcapi "eth,net,personal,web3" --rpccorsdomain "*" --datadir gethdata --port "30304" --nodiscover --networkid 91036 --allow-insecure-unlock --dev.period 1 --syncmode "full" init genesis.json && geth1 --identity "MyEth" --rpc --rpcport "8546" --rpcapi "eth,net,personal,web3" --rpccorsdomain "*" --datadir gethdata --port "30304" --nodiscover --networkid 91036 --allow-insecure-unlock --dev.period 1 --syncmode "full" console
```

成功进入控制台后，输入`exit`退出。

在n2-p42中执行如下指令：

```bash
geth1 --identity "MyEth" --rpc --rpcport "8542" --rpccorsdomain "*" --datadir gethdata --port "30302" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 init genesis.json && geth1 --identity "MyEth" --rpc --rpcport "8542" --rpccorsdomain "*" --datadir gethdata --port "30302" --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --allow-insecure-unlock --dev.period 1 console
```

成功进入控制台后，输入`exit`退出。

做完上述准备工作之后，在n1-p45中使用如下指令进入控制台：

```bash
geth1 --identity "MyEth" --rpc --rpcport "8545" --rpcapi "eth,net,personal,web3" --rpccorsdomain "*" --datadir gethdata --port "30303" --nodiscover --networkid 91036 --allow-insecure-unlock --dev.period 1 --syncmode "full" console
```

在这个控制台中输入：

```js
personal.newAccount("123456")
```

获得信息：

```
INFO [10-20|17:37:50.912] Your new key was generated               address=0x0734A40e238DeDEa0802dd19C5Ff07e95c5FFD5f
WARN [10-20|17:37:50.912] Please backup your key file!             path=/home/endericedragon/文档/WQL-Lab/MultiNodes/Node1/gethdata/keystore/UTC--2022-10-20T09-37-48.750068217Z--0734a40e238dedea0802dd19c5ff07e95c5ffd5f
WARN [10-20|17:37:50.912] Please remember your password! 
"0x0734a40e238dedea0802dd19c5ff07e95c5ffd5f"
```

退出，并更改Node1中的genesis.json为如下内容：

```json
{
    "config": {
        "chainId": 91036,
        "homesteadBlock": 0,
        "eip150Block": 0,
        "eip155Block": 0,
        "eip158Block": 0,
        "byzantiumBlock": 0,
        "constantinopleBlock": 0,
        "petersburgBlock": 0
    },
    "alloc": {
        "0x0734a40e238dedea0802dd19c5ff07e95c5ffd5f": {
            "balance": "50000000000000000000000000000000000000000"
        }
    },
    "coinbase": "0x0000000000000000000000000000000000000000",
    "difficulty": "0x20000",
    "extraData": "",
    "gasLimit": "0xffffffff",
    "nonce": "0x0000000000000042",
    "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
    "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
    "timestamp": "0x00"
}
```

完成上述操作之后，将Node1/gethdata/geth目录删除。

在n1-p45中输入：

```bash
geth1 init ./genesis.json --datadir "./gethdata"
```

再进入控制台：

```bash
geth1 --identity "MyEth" --rpc --rpcaddr 127.0.0.1 --rpccorsdomain "*" --datadir "./gethdata" --port 30303 --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --rpcport 8545 --allow-insecure-unlock --dev.period 1 console
```

执行：

```js
personal.unlockAccount(eth.accounts[0], "123456", 15000)
// true
eth.getBalance(eth.accounts[0])
// 5e+40
```

随后，在n2-p46中输入如下指令以重新年初始化节点2：

```bash
geth1 init ./genesis.json --datadir "./gethdata"
```

随后启动之：

```bash
geth1 --identity "MyEth" --rpc --rpcaddr 127.0.0.1 --rpccorsdomain "*" --datadir "./gethdata" --port 30304 --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --rpcport 8546 --allow-insecure-unlock --dev.period 1 console
```

在n1-p45中输入指令，以获取节点信息：

```js
admin.nodeInfo.enode
// "enode://25b2c29e26314975d46d47f068b3396c83bd2253053dae61330340d6b5edaa17982af8c21020910df40898fe8b3822bfa94dc60b76c834c2288d371a88398074@127.0.0.1:30303?discport=0"
```

随后在n2-p46中输入：

```js
admin.addPeer("enode://25b2c29e26314975d46d47f068b3396c83bd2253053dae61330340d6b5edaa17982af8c21020910df40898fe8b3822bfa94dc60b76c834c2288d371a88398074@127.0.0.1:30303?discport=0")
```

输入如下指令，验证连接：

```js
admin.peers
// []
```

**！不明晰点！怎么还是不对？？**

解决方案：Node1和Node2中的genesis.json没有同步，而且根据复现手册里的说法，应该把Node1中的所谓Key文件复制到Node2中。

具体来说，需要将Node1中的genesis.json复制到Node2文件夹中，并删除Node/gethdata/geth，这样才能成功初始化。另外，还需要将Node1/gethdata/keystore中的文件复制一份到Node2/gethdata/keystore中。

如此操作之后，再在n2-p46中执行：

```bash
geth1 init ./genesis.json --datadir "./gethdata" && geth1 --identity "MyEth" --rpc --rpcaddr 127.0.0.1 --rpccorsdomain "*" --datadir "./gethdata" --port 30304 --nodiscover --rpcapi "eth,net,personal,web3" --networkid 91036 --rpcport 8546 --allow-insecure-unlock --dev.period 1 console
```

在打开的控制台中输入：

```js
admin.addPeer("enode://25b2c29e26314975d46d47f068b3396c83bd2253053dae61330340d6b5edaa17982af8c21020910df40898fe8b3822bfa94dc60b76c834c2288d371a88398074@127.0.0.1:30303?discport=0")
```

激动人心的一刻到来了，在n2-p46中输入：

```js
admin.peers
/* 
[{
    caps: ["eth/63", "eth/64", "eth/65"],
    enode: "enode://25b2c29e26314975d46d47f068b3396c83bd2253053dae61330340d6b5edaa17982af8c21020910df40898fe8b3822bfa94dc60b76c834c2288d371a88398074@127.0.0.1:30303?discport=0",
    id: "ab743639039822df765ef88af723b84e82cdbd8561109ea2de8de813a5e1ba97",
    name: "Geth/MyEth/v1.9.12-stable-27356db6/linux-amd64/go1.13.9",
    network: {
      inbound: false,
      localAddress: "127.0.0.1:49012",
      remoteAddress: "127.0.0.1:30303",
      static: true,
      trusted: false
    },
    protocols: {
      eth: {
        difficulty: 131072,
        head: "0x6959562a4f2f4ac98ef4ffda2e26840e9cbb623d2848d26912eaeda662377182",
        version: 65
      }
    }
}]
> INFO [10-20|18:01:29.528] Looking for peers                        peercount=1 tried=1 static=1
*/
```

获得了注释中所示的返回值！两个节点连接成功了！

在n1-p45中输入：

```js
miner.start()
```

仍然等待percentage走到约99之后，在n1-p45和n2-p46中同步地出现了区块的验证信息。至此，该实验的输出完全满足期望输出，复现成功。
